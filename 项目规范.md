# 项目规范

## 配置管理

### 统一配置管理接口

项目使用统一的配置管理接口，所有配置访问都应该通过 `src/config.py` 中的访问器函数进行。

#### 访问器函数列表

- `API_KEY()` - 获取 OpenAI API 密钥
- `BASE_URL()` - 获取 OpenAI API 基础 URL
- `MODEL_NAME()` - 获取 OpenAI 模型名称
- `PROXY_URL()` - 获取代理 URL
- `NTFY_TOPIC_URL()` - 获取 NTFY 主题 URL
- `GOTIFY_URL()` - 获取 Gotify 服务器 URL
- `GOTIFY_TOKEN()` - 获取 Gotify 访问令牌
- `BARK_URL()` - 获取 Bark 通知 URL
- `WX_BOT_URL()` - 获取微信机器人 URL
- `WX_CORP_ID()` - 获取企业微信 CorpID
- `WX_AGENT_ID()` - 获取企业微信 AgentID
- `WX_SECRET()` - 获取企业微信 Secret
- `WX_TO_USER()` - 获取企业微信接收用户
- `TELEGRAM_BOT_TOKEN()` - 获取 Telegram 机器人令牌
- `TELEGRAM_CHAT_ID()` - 获取 Telegram 聊天 ID
- `WEBHOOK_URL()` - 获取 Webhook URL
- `WEBHOOK_METHOD()` - 获取 Webhook 请求方法
- `WEBHOOK_HEADERS()` - 获取 Webhook 头部信息
- `WEBHOOK_CONTENT_TYPE()` - 获取 Webhook 内容类型
- `WEBHOOK_QUERY_PARAMETERS()` - 获取 Webhook 查询参数
- `WEBHOOK_BODY()` - 获取 Webhook 内容
- `PCURL_TO_MOBILE()` - 检查是否需要将 PC 链接转换为移动链接
- `RUN_HEADLESS()` - 检查是否需要以无头模式运行浏览器
- `LOGIN_IS_EDGE()` - 检查是否需要使用 Edge 浏览器登录
- `RUNNING_IN_DOCKER()` - 检查是否在 Docker 容器中运行
- `AI_DEBUG_MODE()` - 检查是否启用 AI 调试模式
- `SKIP_AI_ANALYSIS()` - 检查是否跳过 AI 分析
- `ENABLE_THINKING()` - 检查是否启用思考功能
- `ENABLE_RESPONSE_FORMAT()` - 检查是否启用响应格式
- `SEND_URL_FORMAT_IMAGE()` - 检查是否发送 URL 格式的图片
- `SERVER_PORT()` - 获取服务器端口

#### 配置保存函数

- `save_env_settings(settings: dict, setting_keys: list)` - 保存配置到 `.env` 文件
- `reload_config()` - 重新加载配置并重新初始化 AI 客户端

### 配置加载方式

项目使用 `.env` 文件来存储配置信息，`load_dotenv()` 函数会在程序启动时自动加载配置。

## 代码结构

### 目录结构

```
├── src/
│   ├── config.py - 统一配置管理接口
│   ├── utils.py - 通用工具函数
│   ├── ai_handler.py - AI 处理模块
│   ├── scraper.py - 数据采集模块
│   ├── parsers.py - 数据解析模块
│   ├── task.py - 任务管理模块
│   ├── version.py - 版本管理模块
│   ├── file_operator.py - 文件操作模块
│   ├── notifier/ - 通知模块
│   │   ├── __init__.py
│   │   ├── config.py - 通知配置管理
│   │   ├── base.py - 通知基础类
│   │   └── channels.py - 通知渠道实现
│   └── web/ - Web 服务模块
│       ├── __init__.py
│       ├── main.py - Web 服务入口
│       ├── auth.py - 认证模块
│       ├── task_manager.py - 任务管理接口
│       ├── settings_manager.py - 设置管理接口
│       ├── notification_manager.py - 通知管理接口
│       ├── ai_manager.py - AI 管理接口
│       ├── log_manager.py - 日志管理接口
│       ├── scheduler.py - 调度器模块
│       └── models.py - 数据模型
├── static/ - 静态文件目录
├── templates/ - 模板文件目录
├── logs/ - 日志文件目录
├── jsonl/ - 数据文件目录
├── prompts/ - 提示词文件目录
├── criteria/ - 标准文件目录
├── images/ - 图片文件目录
├── task_stats/ - 任务统计文件目录
├── requirements.txt - 依赖包列表
├── .env - 配置文件
└── README.md - 项目说明
```

### 代码规范

1. 所有模块应该直接使用统一配置管理接口获取配置
2. 工具函数应该定义在 `src/utils.py` 中，其他模块应该直接导入使用
3. 配置保存应该使用 `save_env_settings()` 函数
4. 通知配置应该使用 `src/notifier/config.py` 中的 `config` 单例
5. Web 服务应该使用 `src/web/main.py` 作为入口

## 测试

### 单元测试

项目应该包含单元测试，测试各个模块的功能。

### 集成测试

项目应该包含集成测试，测试整个系统的功能。

## 部署

### 开发环境

1. 克隆项目代码
2. 安装依赖包
3. 配置 `.env` 文件
4. 运行开发服务器

### 生产环境

1. 克隆项目代码
2. 安装依赖包
3. 配置 `.env` 文件
4. 运行生产服务器
