#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
版本信息文件
"""
VERSION = "V0.9.7"

VERSION_HISTORY = [
    {
        "version": "V0.9.7",
        "date": "2026-01-17",
        "changes": [
            "新增多账号管理系统，支持添加、编辑、删除多个咸鱼账号",
            "新增从当前登录状态一键导入账号功能",
            "任务创建时支持选择使用的咸鱼账号",
            "任务支持设置风控时自动切换账号功能",
            "任务编辑模态框新增AI标准Tab切换（需求/AI标准）",
            "任务编辑支持参考文件模板选择和预览",
            "新生成/重新生成AI标准按钮移至模态框底部",
            "编辑模态框账号选择器添加颜色指示器",
            "任务表格绑定账号显示使用display_name",
            "任务表格绑定账号改为点击显示下拉框选择模式",
            "Switch开关统一排版，放置在选项组内",
            "账号管理页面标题改为闲鱼账号管理",
            "账号显示使用彩色标签，基于账号名自动生成固定颜色",
            "简化账号添加表单，自动生成账号标识",
            "账号管理页面展示账号风控历史记录",
            "优化账号选择器和开关组件UI样式",
            "collector.py 支持传递 bound_account 参数给 scraper",
            "修复模态框可见性问题（opacity/visibility）",
            "修复从当前登录导入API路径错误",
            "修复账号创建时state_data类型错误",
            "修复AI标准生成按钮API调用逻辑",
            "统一三处账号颜色显示使用相同颜色函数",
            "新增自定义登录页面，替代浏览器Basic Auth弹窗",
            "登录认证改用签名Cookie Session方案",
            "支持7天免登录，预留多用户扩展接口",
            "简化登录下拉菜单，只保留退出登录选项",
            "账号表格新增状态列显示Cookie有效性",
            "账号操作新增测试Cookie和复制账号功能",
            "复制账号自动命名（副本1，副本2...）",
            "手动添加按钮复用Cookie输入模态框",
            "修复表单回车刷新问题",
            "调整导航栏顺序（运行日志移到账号管理后）",
            "默认随机选择可用账号运行任务",
            "修复账号最后使用时间不更新问题",
            "定期自动检测Cookie状态（每5分钟）",
            "弃用xianyu_state.json，改用多账号管理系统",
            "修复手动添加账号模态框alert后数据丢失问题",
            "任务执行前验证Cookie有效性",
            "无有效账号时发送通知并结束任务",
            "删除重复的任务失败通知框",
            "运行日志默认限制100条避免内存消耗",
            "运行日志支持选择展示条数(100/200/500/1000)",
            "CMD系统日志同步到运行日志页面",
            "新增钉钉机器人通知渠道，支持加签验证",
            "钉钉通知支持ActionCard图文卡片格式",
            "main.js 添加了WX_SECRET、DINGTALK_SECRET和API_KEY的密码可见性切换功能"
        ]
    },
    {
        "version": "V0.9.6",
        "date": "2026-01-16",
        "changes": [
            "添加了定时任务管理界面，方便了解定时进程",
            "新增定时任务执行列表，支持查看任务执行顺序和下次执行时间",
            "新增 Cron 表达式在线编辑功能，并在修改后自动同步到任务配置",
            "新增跳过本次任务、立即执行任务、取消任务（保留配置关闭启用）功能",
            "修复了启用按钮开关报错",
            "修复了创建表达式保存没有载入任务问题",
            "整合了系统日志到控制台输出",
            "添加了开始任务和结束任务通知，添加了统计计数",
            "重构了 web_server.py，将其拆分为 main.py, auth.py, scheduler.py, task_manager.py 等 9 个独立模块，提升可维护性",
            "统一配置管理，重构通知配置，简化 utils 文件，更新设置管理器",
            "创建项目规范文档，规范项目结构和代码标准",
            "添加定时中状态显示",
            "升级新闲鱼登录状态自动提取器，实现浏览器环境信息捕获功能，集成设备信息、请求头、本地存储快照功能"
        ]
    },
    {
        "version": "V0.9.5",
        "date": "2026-01-04",
        "changes": [
            "修改了项目中部分具有争议词汇替换为中性、合规的表述",
            "修复了单独删除商品结果无效的问题",
            "修复了任务运行中，通知没有检查通知渠道是否开启通知的问题",
            "修复了自动触发发送的企业微信群机器人图文消息会出现标题、价格时间等文案信息不对的情况",
            "添加了完成任务后会推送一条通知消息到通知渠道",
            "修复了没有手动任务在结束任务后没有更新任务状态的bug",
            "添加了测试任务完成通知按钮",
            "现在通知配置和系统设置的Switch开关都能自动保存设置了",   
            "优化了筛选框的文字显示去除了没必要的后缀提高了可读性",  
            "优化了单独删除卡片时会删除错误的卡片的问题"  
        ]
    },
    {
        "version": "V0.9.2",
        "date": "2026-01-02",
        "changes": [
            "优化了通知模板尽量满足图文通知需求",
            "添加数据筛滤机制，解决部分情况下前端按钮卡死问题",
            "对自动登录程序添加追踪与限制，避免重复触发占用资源",
            "优化修改了部分文案",
            "添加了渠道通知开关"                
        ]
    },
    {
        "version": "V0.9.0",
        "date": "2026-01-01",
        "changes": [
            "元旦快乐",
            "添加了自动获取cookie登录按钮，优化了login.py的登录逻辑",
            "在搜索结果添加了手动搜索，并且能高光显示搜索匹配内容",
            "优化了管理界面的UI视觉效果，现在更好看了",
            "添加了版本号，与docker版本号接轨",
            "优化了start_web_server.bat的字体颜色和添加了版本号，引导更清晰了",
            "优化了微信群机器人等渠道通知逻辑",
            "商品卡如果没有整理到图片则选择默认logo",
            "卖家名字过长的分行到第二行，避免挤压到发送通知",            
            "修改了scraper.py和ai_handler.py里的冗余通知代码，通知全部转移到专用的notifier里"                
        ]
    }
]

# 获取当前版本
def get_current_version():
    """获取当前版本号"""
    return VERSION

# 获取当前版本信息
def get_current_version_info():
    """获取当前版本的详细信息"""
    for version_info in VERSION_HISTORY:
        if version_info["version"] == VERSION:
            return version_info
    return None
