<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>咸鱼AI智能推荐机器人</title>
    <link rel="icon" type="image/png" href="/images/logo/favicon 32x32.png" sizes="32x32">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/bayes_visual.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            text-transform: uppercase;
            display: inline-block;
            line-height: 1.5;
            text-align: center;
            vertical-align: baseline;
            white-space: nowrap;
        }

        .status-running {
            background-color: #28a745;
            /* green */
        }

        .status-stopped {
            background-color: #6c757d;
            /* gray */
        }

        .tasks-table .action-btn {
            padding: 6px 10px;
            margin-right: 5px;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            line-height: 1;
            white-space: nowrap;
            min-width: 48px;
            box-sizing: border-box;
        }

        .tasks-table .run-task-btn {
            background-color: #52c41a;
            color: white;
            border-color: #52c41a;
        }

        .tasks-table .run-task-btn:hover {
            background-color: #389e0d;
            border-color: #389e0d;
        }

        .tasks-table .stop-task-btn {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .tasks-table .stop-task-btn:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }

        .tasks-table .edit-btn {
            background-color: #fff533;
            color: #212529;
            border-color: #fff533;
        }

        .tasks-table .edit-btn:hover {
            background-color: #e8de2b;
            border-color: #dcd028;
        }

        .tasks-table .copy-btn {
            background-color: #17a2b8;
            color: white;
            border-color: #17a2b8;
        }

        .tasks-table .copy-btn:hover {
            background-color: #138496;
            border-color: #117a8b;
        }

        .tasks-table .delete-btn {
            background-color: #6c757d;
            color: white;
            border-color: #6c757d;
        }

        .tasks-table .delete-btn:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }

        .tasks-table .action-btn:disabled {
            background-color: #cccccc;
            border-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.65;
        }

        .modal-content.large {
            max-width: 800px;
        }

        .instructions {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            padding-left: 35px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: left;
        }

        .instructions li {
            margin-bottom: 10px;
        }

        .code-block {
            position: relative;
            background-color: #eef;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 0.9em;
            color: #333;
        }

        .code-block .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 2px 6px;
        }

        .login-status-widget {
            cursor: pointer;
            z-index: 101;
            /* Ensure it's above other header content */
            padding-bottom: 5px;
        }

        .login-status-widget .status-text {
            padding: 8px 12px;
            border-radius: 16px;
            color: white;
            font-size: 0.9em;
            display: inline-block;
        }

        .login-status-widget .status-ok {
            background-color: #28a745;
        }

        .login-status-widget .status-error {
            background-color: #dc3545;
        }

        .login-status-widget .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            padding: 5px 0;
        }

        /* .login-status-widget:hover .dropdown-menu {
            display: block;
        } */

        .login-status-widget .dropdown-item {
            display: block;
            padding: 8px 12px;
            color: #333;
            text-decoration: none;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .login-status-widget .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .login-status-widget .dropdown-item.delete {
            color: #dc3545;
        }

        /* 下拉菜单样式 */
        .dropdown-container {
            position: relative;
            display: inline-block;
        }

        .dropdown-btn {
            padding: 6px 10px;
            margin-right: 5px;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #1890ff;
            color: white;
            border-color: #1890ff;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            white-space: nowrap;
            min-width: 56px;
            box-sizing: border-box;
        }

        .dropdown-btn:hover {
            background-color: #40a9ff;
            border-color: #40a9ff;
        }

        .dropdown-btn:disabled {
            background-color: #cccccc;
            border-color: #cccccc;
            color: #ffffff;
            cursor: not-allowed;
            opacity: 0.65;
        }

        .tasks-table .run-task-btn,
        .tasks-table .stop-task-btn,
        .accounts-table .test-account-btn,
        .accounts-table .dropdown-btn {
            height: 32px;
            box-sizing: border-box;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            min-width: 120px;
            margin-top: 5px;
            z-index: 1000;
        }

        .dropdown-menu.open-up {
            top: auto;
            bottom: 100%;
            margin-top: 0;
            margin-bottom: 5px;
            transform-origin: bottom right;
        }

        .dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease-in-out;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-menu .dropdown-item {
            display: block;
            padding: 8px 16px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .dropdown-menu .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .dropdown-menu .dropdown-item i {
            margin-right: 8px;
            width: 16px;
            text-align: center;
        }

        /* 任务管理表格操作列样式 */
        .tasks-table .action-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .tasks-table .dropdown-container {
            vertical-align: middle;
        }

        /* 确保操作按钮容器在表格中水平对齐 */
        .tasks-table .action-buttons {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 40px;
            flex-wrap: nowrap;
        }

        /* 账号管理表格操作列样式 */
        .accounts-table .dropdown-container {
            vertical-align: middle;
        }

        @media (max-width: 1200px) {
            .tasks-table .action-buttons {
                flex-direction: column;
                align-items: center;
                gap: 4px;
            }

            .tasks-table .action-buttons .action-btn,
            .tasks-table .action-buttons .dropdown-btn {
                width: 72px;
                margin-right: 0;
            }
        }
    </style>
</head>

<body>
    <header
        style="position: relative; height: 64px; display: flex; align-items: center; padding: 0 24px; justify-content: space-between;">
        <div style="display: flex; align-items: center;">
            <button id="mobile-menu-toggle" class="mobile-menu-btn"
                style="display: none; background: none; border: none; font-size: 24px; cursor: pointer; margin-right: 12px;">
                ☰
            </button>
        </div>

        <div class="logo-container"
            style="text-align: center; display: flex; justify-content: center; align-items: center;">
            <img src="/images/logo/logo 128x128.png" alt="Logo"
                style="height: 40px; border-radius: 8px; vertical-align: middle; margin-right: 12px;">
            <h1 style="font-size: 22px; margin: 0; color: #1a1a1a; vertical-align: middle; display: inline-block;">
                咸鱼AI智能推荐机器人</h1>
        </div>

        <div id="login-status-widget-container" style="z-index: 10;"></div>
    </header>
    <div class="container">
        <aside>
            <div class="version-container sidebar-version">
                <span id="version-info">{{ version }}</span>
                <button id="sidebar-toggle-btn" class="sidebar-toggle-btn" type="button"
                    aria-label="&#25910;&#36215;&#20391;&#36793;&#26639;"
                    title="&#25910;&#36215;&#20391;&#36793;&#26639;">
                    &lt;&lt;&lt;
                </button>
            </div>
            <nav>
                <ul>
                    <li><a href="#tasks" class="nav-link active">任务管理</a></li>
                    <li><a href="#accounts" class="nav-link">账号管理</a></li>
                    <li><a href="#scheduled" class="nav-link">定时任务</a></li>
                    <li><a href="#results" class="nav-link">结果查看</a></li>
                    <li><a href="#logs" class="nav-link">运行日志</a></li>
                    <li><a href="#notifications" class="nav-link">通知配置</a></li>
                    <li><a href="#model-management" class="nav-link">模型管理</a></li>
                    <li><a href="#settings" class="nav-link">系统设置</a></li>
                </ul>
            </nav>
        </aside>
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <main id="main-content">
            <!-- 内容将根据侧边栏选择动态加载 -->
        </main>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>创建新监控任务 (AI驱动)</h2>
                <button id="close-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-task-form">
                    <div class="form-group switch-group">
                        <div class="switch-label-row">
                            <span class="switch-label-text">风控时自动切换账号</span>
                            <label class="switch">
                                <input type="checkbox" id="auto-switch-on-risk" name="auto_switch_on_risk">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="form-hint">当触发风控保护时，自动切换到其他可用账号继续执行</p>
                    </div>
                    <div class="form-group">
                        <label for="task-name">任务名称<span class="required-pill">必填</span></label>
                        <input type="text" id="task-name" name="task_name" placeholder="例如：索尼 A7M4 相机" required>
                    </div>
                    <div class="form-group">
                        <label for="keyword">搜索关键词<span class="required-pill">必填</span></label>
                        <input type="text" id="keyword" name="keyword" placeholder="例如：a7m4" required>
                    </div>
                    <div class="form-group form-group-inline">
                        <div>
                            <label for="min-price">价格范围 (可选)</label>
                            <input type="number" id="min-price" name="min_price" placeholder="最低价">
                        </div>
                        <span>-</span>
                        <div>
                            <label for="max-price">&nbsp;</label>
                            <input type="number" id="max-price" name="max_price" placeholder="最高价">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="max-pages">最大搜索页数<span class="required-pill">必填</span></label>
                        <input type="number" id="max-pages" name="max_pages" value="3" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="bound-account">使用账号</label>
                        <select id="bound-account" name="bound_account" class="styled-select">
                            <option value="">不限（使用默认登录状态）</option>
                            <!-- 账号选项将通过JS动态填充 -->
                        </select>
                        <p class="form-hint">选择执行此任务时使用的咸鱼账号</p>
                    </div>
                    <div class="form-group">
                        <label>筛选条件</label>
                        <div class="tag-toggle-group">
                            <label class="tag-toggle">
                                <input type="checkbox" id="personal-only" name="personal_only" checked>
                                <span>个人闲置</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="free-shipping" name="free_shipping">
                                <span>包邮</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="inspection-service" name="inspection_service">
                                <span>验货宝</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="account-assurance" name="account_assurance">
                                <span>验号担保</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="super-shop" name="super_shop">
                                <span>超赞鱼小铺</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="brand-new" name="brand_new">
                                <span>全新</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="strict-selected" name="strict_selected">
                                <span>严选</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="resale" name="resale">
                                <span>转卖</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-publish-option">新发布时间</label>
                        <select id="new-publish-option" name="new_publish_option" class="styled-select">
                            <option value="">最新</option>
                            <option value="1天内">1天内</option>
                            <option value="3天内">3天内</option>
                            <option value="7天内">7天内</option>
                            <option value="14天内">14天内</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>区域筛选</label>
                        <div class="region-select-row">
                            <select id="region-province" class="styled-select">
                                <option value="">省/自治区/直辖市</option>
                            </select>
                            <select id="region-city" class="styled-select">
                                <option value="">市/地区</option>
                            </select>
                            <select id="region-district" class="styled-select">
                                <option value="">区/县</option>
                            </select>
                        </div>
                        <p class="form-hint">选择省/市/区（可只选到任意层级）</p>
                    </div>
                    <div class="form-group">
                        <label for="task-cron">定时执行 (Cron 表达式)
                            <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer"
                                title="点击查看Cron表达式帮助">[帮助]</a>
                        </label>
                        <input type="text" id="task-cron" name="cron" placeholder="分 时 日 月 周 (例如: 0 8 * * *)">
                        <p class="form-hint">留空则不启用定时执行。例如 "0 22 * * *" 表示每晚22:00执行。</p>
                    </div>
                    <div class="form-group">
                        <label for="reference-file-selector">参考文件模板</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <select id="reference-file-selector"
                                style="flex: 1; padding: 10px 12px; font-size: 14px; border: 1px solid #d9d9d9; border-radius: 4px; transition: border-color 0.3s; box-sizing: border-box;">
                                <option value="">正在加载...</option>
                            </select>
                            <button id="preview-reference-file-btn" class="control-button"
                                style="flex-shrink: 0; background-color: #52c41a; color: white; border-color: #52c41a; padding: 10px 16px;">预览</button>
                        </div>
                        <p class="form-hint">选择AI生成标准的参考文件模板</p>
                    </div>
                    <div class="form-group" id="reference-preview-container" style="display: none;">
                        <label for="reference-file-preview">参考文件预览</label>
                        <pre id="reference-file-preview"
                            style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto;">参考文件内容...</pre>
                        <p class="form-hint">预览内容不可修改，修改请前往系统设置 > Prompt 管理</p>
                    </div>
                    <div class="form-group">
                        <label for="bayes-profile">Bayes 参数</label>
                        <select id="bayes-profile" name="bayes_profile" class="styled-select">
                            <option value="bayes_v1" selected>bayes_v1（默认）</option>
                            <option value="disabled">不启用（仅AI证据链）</option>
                        </select>
                        <p class="form-hint">每个任务可选择不同的 Bayes 先验参数版本</p>
                    </div>
                    <div class="form-group">
                        <label for="task-description">详细购买需求<span class="required-pill">必填</span></label>
                        <textarea id="task-description" name="description" rows="6"
                            placeholder="请用自然语言详细描述你的购买需求，AI将根据此描述生成分析标准。例如：我想买一台95新以上的索尼A7M4相机，预算在10000到13000元之间，快门数要低于5000。必须是国行且配件齐全。优先考虑个人卖家..."
                            required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-add-task-btn" class="control-button">取消</button>
                <button id="save-new-task-btn" class="control-button primary-btn">
                    <span class="btn-text">创建任务</span>
                    <span class="spinner" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>


    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>编辑监控任务</h2>
                <button id="close-edit-task-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-task-form">
                    <input type="hidden" id="edit-task-id" name="task_id">
                    <div class="form-group switch-group">
                        <div class="switch-label-row">
                            <span class="switch-label-text">启用任务</span>
                            <label class="switch">
                                <input type="checkbox" id="edit-task-enabled" name="enabled">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group switch-group">
                        <div class="switch-label-row">
                            <span class="switch-label-text">风控时自动切换账号</span>
                            <label class="switch">
                                <input type="checkbox" id="edit-auto-switch-on-risk" name="auto_switch_on_risk">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p class="form-hint">当触发风控保护时，自动切换到其他可用账号继续执行</p>
                    </div>
                    <div class="form-group">
                        <label for="edit-task-name">任务名称<span class="required-pill">必填</span></label>
                        <input type="text" id="edit-task-name" name="task_name" placeholder="例如：索尼 A7M4 相机" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-keyword">搜索关键词<span class="required-pill">必填</span></label>
                        <input type="text" id="edit-keyword" name="keyword" placeholder="例如：a7m4" required>
                    </div>
                    <div class="form-group form-group-inline">
                        <div>
                            <label for="edit-min-price">价格范围 (可选)</label>
                            <input type="number" id="edit-min-price" name="min_price" placeholder="最低价">
                        </div>
                        <span>-</span>
                        <div>
                            <label for="edit-max-price">&nbsp;</label>
                            <input type="number" id="edit-max-price" name="max_price" placeholder="最高价">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-max-pages">最大搜索页数<span class="required-pill">必填</span></label>
                        <input type="number" id="edit-max-pages" name="max_pages" value="3" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-bound-account">使用账号</label>
                        <select id="edit-bound-account" name="bound_account" class="styled-select"
                            style="border: 4px solid #ccc; border-radius: 6px;">
                            <option value="">不限（使用默认登录状态）</option>
                            <!-- 账号选项将通过JS动态填充 -->
                        </select>
                        <p class="form-hint">选择执行此任务时使用的咸鱼账号</p>
                    </div>
                    <div class="form-group">
                        <label>筛选条件</label>
                        <div class="tag-toggle-group">
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-personal-only" name="personal_only">
                                <span>个人闲置</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-free-shipping" name="free_shipping">
                                <span>包邮</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-inspection-service" name="inspection_service">
                                <span>验货宝</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-account-assurance" name="account_assurance">
                                <span>验号担保</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-super-shop" name="super_shop">
                                <span>超赞鱼小铺</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-brand-new" name="brand_new">
                                <span>全新</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-strict-selected" name="strict_selected">
                                <span>严选</span>
                            </label>
                            <label class="tag-toggle">
                                <input type="checkbox" id="edit-resale" name="resale">
                                <span>转卖</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-new-publish-option">新发布时间</label>
                        <select id="edit-new-publish-option" name="new_publish_option" class="styled-select">
                            <option value="">最新</option>
                            <option value="1天内">1天内</option>
                            <option value="3天内">3天内</option>
                            <option value="7天内">7天内</option>
                            <option value="14天内">14天内</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>区域筛选</label>
                        <div class="region-select-row">
                            <select id="edit-region-province" class="styled-select">
                                <option value="">省/自治区/直辖市</option>
                            </select>
                            <select id="edit-region-city" class="styled-select">
                                <option value="">市/地区</option>
                            </select>
                            <select id="edit-region-district" class="styled-select">
                                <option value="">区/县</option>
                            </select>
                        </div>
                        <p class="form-hint">选择省/市/区（可只选到任意层级）</p>
                    </div>
                    <div class="form-group">
                        <label for="edit-task-cron">定时执行 (Cron 表达式)
                            <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer"
                                title="点击查看Cron表达式帮助">[帮助]</a>
                        </label>
                        <input type="text" id="edit-task-cron" name="cron" placeholder="分 时 日 月 周 (例如: 0 8 * * *)">
                        <p class="form-hint">留空则不启用定时执行。例如 "0 22 * * *" 表示每晚22:00执行。</p>
                    </div>
                    <!-- AI标准模块 -->
                    <div class="form-group">
                        <label for="edit-reference-file-selector">参考文件模板</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <select id="edit-reference-file-selector" class="styled-select" style="flex: 1;">
                                <option value="">正在加载...</option>
                            </select>
                            <button type="button" id="edit-preview-reference-btn" class="control-button small-btn"
                                style="background-color: #52c41a; color: white; border-color: #52c41a;">预览</button>
                        </div>
                        <p class="form-hint">选择AI生成标准的参考文件模板</p>
                    </div>
                    <div class="form-group" id="edit-reference-preview-container" style="display: none;">
                        <pre id="edit-reference-file-preview"
                            style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 120px; overflow-y: auto; font-size: 11px; margin: 0;">参考文件内容...</pre>
                    </div>
                    <div class="form-group">
                        <label for="edit-bayes-profile">Bayes 参数</label>
                        <select id="edit-bayes-profile" name="bayes_profile" class="styled-select">
                            <option value="bayes_v1">bayes_v1（默认）</option>
                            <option value="disabled">不启用（仅AI证据链）</option>
                        </select>
                        <p class="form-hint">编辑任务时可切换 Bayes 先验参数版本</p>
                    </div>

                    <!-- AI标准Tab切换 -->
                    <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <label style="margin-bottom: 0;">当前AI标准</label>
                            <span id="edit-criteria-status-text"
                                style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background-color: #52c41a; color: #fff;">已生成</span>
                        </div>

                        <!-- Tab按钮 -->
                        <div id="edit-criteria-tabs"
                            style="display: flex; border-bottom: 1px solid #e8e8e8; margin-bottom: 10px;">
                            <button type="button" class="edit-criteria-tab active" data-tab="requirement"
                                style="padding: 8px 16px; border: none; background: none; cursor: pointer; font-size: 13px; border-bottom: 2px solid #1890ff; color: #1890ff; margin-bottom: -1px;">
                                需求
                            </button>
                            <button type="button" class="edit-criteria-tab" data-tab="criteria"
                                style="padding: 8px 16px; border: none; background: none; cursor: pointer; font-size: 13px; color: #666; margin-bottom: -1px;">
                                AI标准
                            </button>
                        </div>

                        <!-- Requirement内容 -->
                        <div id="edit-tab-requirement" class="edit-criteria-tab-content">
                            <textarea id="edit-task-description" name="description" rows="5" style="font-size: 12px;"
                                placeholder="在此编辑购买需求描述..."></textarea>
                        </div>

                        <!-- Criteria内容 -->
                        <div id="edit-tab-criteria" class="edit-criteria-tab-content" style="display: none;">
                            <textarea id="edit-criteria-content" rows="5" style="font-size: 12px;"
                                placeholder="AI生成的标准内容..."></textarea>
                        </div>

                        <!-- 提示文案 -->
                        <p class="form-hint" style="font-size: 11px; margin-top: 10px;">修改需求后请点击下方"新生成并保存"或"重新生成并保存"按钮
                        </p>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="gap: 10px;">
                <button id="cancel-edit-task-btn" class="control-button">取消</button>
                <button type="button" id="edit-regenerate-criteria-btn" class="control-button"
                    style="background-color: #52c41a; color: white; border-color: #52c41a;">
                    新生成并保存
                </button>
                <button id="save-edit-task-btn" class="control-button primary-btn">
                    <span class="btn-text">保存更改</span>
                    <span class="spinner" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>
    <!-- AI Criteria Modal -->
    <div id="ai-criteria-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>AI标准</h2>
                <button id="close-ai-criteria-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div id="ai-criteria-tabs"
                    style="display: flex; border-bottom: 1px solid #e8e8e8; margin-bottom: 10px;">
                    <button type="button" class="ai-criteria-tab active" data-tab="generate"
                        style="padding: 8px 16px; border: none; background: none; cursor: pointer; font-size: 13px; border-bottom: 2px solid #1890ff; color: #1890ff; margin-bottom: -1px;">
                        生成标准
                    </button>
                    <button type="button" class="ai-criteria-tab" data-tab="edit"
                        style="padding: 8px 16px; border: none; background: none; cursor: pointer; font-size: 13px; color: #666; margin-bottom: -1px;">
                        编辑标准
                    </button>
                </div>

                <form id="ai-criteria-form">
                    <div id="ai-criteria-tab-generate" class="ai-criteria-tab-content">
                        <div class="form-group">
                            <label for="ai-criteria-reference-selector">参考文件模板</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <select id="ai-criteria-reference-selector"
                                    style="flex: 1; padding: 10px 12px; font-size: 14px; border: 1px solid #d9d9d9; border-radius: 4px; transition: border-color 0.3s; box-sizing: border-box;">
                                    <option value="">正在加载...</option>
                                </select>
                                <button id="ai-criteria-preview-btn" class="control-button"
                                    style="flex-shrink: 0; background-color: #52c41a; color: white; border-color: #52c41a; padding: 10px 16px;">预览</button>
                            </div>
                            <p class="form-hint">推荐提升输出上限后使用baseV2_prompt，默认使用base_prompt</p>
                        </div>
                        <div class="form-group">
                            <label for="ai-criteria-bayes-profile">Bayes 参数</label>
                            <select id="ai-criteria-bayes-profile"
                                style="width: 100%; padding: 10px 12px; font-size: 14px; border: 1px solid #d9d9d9; border-radius: 4px; transition: border-color 0.3s; box-sizing: border-box;">
                                <option value="">正在加载...</option>
                            </select>
                            <p class="form-hint">默认展示当前任务绑定的 Bayes 参数</p>
                        </div>
                        <div class="form-group" id="ai-criteria-preview-container" style="display: none;">
                            <label for="ai-criteria-preview-content">参考文件预览</label>
                            <pre id="ai-criteria-preview-content"
                                style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto;">参考文件内容..</pre>
                            <p class="form-hint">预览内容不可修改，修改请前往系统设置 &gt; Prompt 管理</p>
                        </div>
                        <div class="form-group">
                            <label for="ai-criteria-description">详细购买需求</label>
                            <textarea id="ai-criteria-description" name="description" rows="6"
                                placeholder="请用自然语言详细描述你的购买需求，AI将根据此描述生成分析标准。例如：我想买一台5新以上的索尼A7M4相机，预算在10000到13000元之间，快门数要低于5000。必须是国行且配件齐全。优先考虑个人卖家..."
                                required></textarea>
                        </div>
                    </div>

                    <div id="ai-criteria-tab-edit" class="ai-criteria-tab-content" style="display: none;">
                        <div class="form-group">
                            <label for="ai-criteria-filename">文件名:</label>
                            <input type="text" id="ai-criteria-filename" readonly style="background-color: #f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label for="ai-criteria-source">生成来源:</label>
                            <input type="text" id="ai-criteria-source" readonly style="background-color: #f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label for="ai-criteria-editor">文件内容:</label>
                            <textarea id="ai-criteria-editor" spellcheck="false" style="height: 360px;"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="gap: 10px;">
                <button id="cancel-ai-criteria-btn" class="control-button">取消</button>
                <button id="ai-criteria-generate-btn" data-mode="generate" class="control-button primary-btn"
                    style="background-color: #fff533; color: #212529; border-color: #fff533; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span class="btn-text">新生成</span>
                    <span class="spinner" style="display: none;"></span>
                    <span class="loading-text" style="display: none;">正在后台生成</span>
                </button>
                <button id="ai-criteria-save-btn" data-mode="edit" class="control-button primary-btn"
                    style="display: none;">保存更改</button>
            </div>
        </div>
    </div>

    <!-- JSON Viewer Modal -->
    <div id="json-viewer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>AI 分析详情</h2>
                <button id="close-json-viewer-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="json-viewer-content"></pre>
            </div>
        </div>
    </div>
    <!-- Manual Login State Modal -->
    <div id="login-state-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>手动更新登录状态 (Cookie)</h2>
                <button id="close-login-state-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-state-form" onsubmit="return false;">
                    <!-- 账号名称输入 -->
                    <div class="form-group">
                        <label for="account-name-input">账号名称 <span style="color: red;">*</span></label>
                        <input type="text" id="account-name-input" name="account_name" placeholder="请输入账号名称（如：我的闲鱼1）"
                            required>
                        <p class="form-hint">给这个账号起一个容易识别的名称</p>
                    </div>

                    <!-- Chrome Extension Method -->
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">使用Chrome扩展（推荐）</h3>
                    <p>此方法用于在无法运行图形化浏览器的服务器上更新闲鱼登录凭证。</p>
                    <p>安装Chrome扩展来提取闲鱼登录状态：</p>
                    <ol class="instructions">
                        <li>在Chrome浏览器中安装 <a
                                href="https://chromewebstore.google.com/detail/xianyu-login-state-extrac/eidlpfjiodpigmfcahkmlenhppfklcoa"
                                target="_blank" rel="noopener noreferrer">闲鱼登录状态提取扩展</a></li>
                        <li>打开并登录 <a href="https://www.goofish.com" target="_blank" rel="noopener noreferrer">闲鱼官网</a>。
                        </li>
                        <li>登录成功后，点击浏览器工具栏中的该扩展图标。</li>
                        <li>点击"提取登录状态"按钮获取登录信息。</li>
                        <li>点击"复制到剪贴板"按钮。</li>
                        <li>将复制的内容粘贴到下方的文本框中，然后点击"保存"。</li>
                    </ol>
                    <div class="form-group">
                        <label for="login-state-content">粘贴JSON内容: <span style="color: red;">*</span></label>
                        <textarea id="login-state-content" name="content" rows="8"
                            placeholder="请在此处粘贴从浏览器扩展复制的JSON文本..." required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-login-state-btn" type="button" class="control-button">取消</button>
                <button id="save-login-state-btn" type="button" class="control-button primary-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- Manual Login Confirmation Modal -->
    <div id="manual-login-confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>自动获取咸鱼cookie登录状态</h2>
                <button id="close-manual-login-confirm-modal" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-top: 20px; margin-bottom: 10px;">自动转跳首页获取咸鱼登录状态</h3>
                <p>此方法用于可图形化浏览器情况自动获取凭证。</p>
                <ol class="instructions">
                    <li>程序自动打开咸鱼首页</li>
                    <li>在咸鱼首页扫码登录</li>
                    <li>登录完成后会自动刷新获取cookie，<strong style="color: red;">请不要手动关闭网页</strong></li>
                    <li>获取登录信息完成后网页会自动关->登录成功</li>
                </ol>
                <p>注意：docker用户无法使用此功能，建议使用手动获取程序</p>
            </div>
            <div class="modal-footer">
                <button id="cancel-manual-login-confirm-btn" class="control-button">取消</button>
                <button id="confirm-manual-login-confirm-btn" class="control-button primary-btn">开始</button>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div id="add-account-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加咸鱼账号</h2>
                <button id="close-add-account-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-account-form">
                    <div class="form-group">
                        <label for="account-display-name">账号名称</label>
                        <input type="text" id="account-display-name" name="display_name" placeholder="例如：主账号、备用账号1"
                            required>
                        <p class="form-hint">用于标识和区分不同的咸鱼账号</p>
                    </div>
                    <div class="form-group">
                        <label for="account-state-content">Cookie数据 (JSON格式)</label>
                        <textarea id="account-state-content" name="state_content" rows="8"
                            placeholder="请粘贴从浏览器扩展复制的JSON内容，或使用上方手动登录按钮获取..." required></textarea>
                        <p class="form-hint">可从手动登录后自动获取，或使用Chrome扩展复制</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-add-account-btn" class="control-button">取消</button>
                <button id="save-new-account-btn" class="control-button primary-btn">
                    <span class="btn-text">保存账号</span>
                    <span class="spinner" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div id="edit-account-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>编辑账号</h2>
                <button id="close-edit-account-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-account-form">
                    <input type="hidden" id="edit-account-name" name="name">
                    <div class="form-group">
                        <label for="edit-account-display-name">显示名称</label>
                        <input type="text" id="edit-account-display-name" name="display_name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-account-state-content">更新Cookie数据 (可选)</label>
                        <textarea id="edit-account-state-content" name="state_content" rows="6"
                            placeholder="留空则保留原有Cookie数据，填写新内容则覆盖更新"></textarea>
                        <p class="form-hint">如需更新Cookie，请粘贴新的JSON内容</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-edit-account-btn" class="control-button">取消</button>
                <button id="save-edit-account-btn" class="control-button primary-btn">保存更改</button>
            </div>
        </div>
    </div>

    <!-- Account Risk Control History Modal -->
    <div id="account-history-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>风控历史记录</h2>
                <button id="close-account-history-modal-btn" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div id="account-history-content">
                    <p>加载中...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/modules/app_state.js"></script>
    <script src="/static/js/modules/templates.js"></script>
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Notification Utility -->
    <script src="/static/js/utils/notification.js"></script>

    <!-- Application Scripts -->
    <script src="/static/js/modules/api.js"></script>
    <script src="/static/js/modules/render.js"></script>
    <script src="/static/js/modules/region.js"></script>
    <script src="/static/js/modules/ui_shell.js"></script>
    <script src="/static/js/modules/tasks_editor.js"></script>
    <script src="/static/js/modules/reorder.js"></script>
    <script src="/static/js/modules/accounts_view.js"></script>
    <script src="/static/js/modules/logs_view.js"></script>
    <script src="/static/js/modules/results_view.js"></script>
    <script src="/static/js/modules/notifications_view.js"></script>
    <script src="/static/js/modules/settings_view.js"></script>
    <script src="/static/js/modules/bayes_visual_manager.js"></script>
    <script src="/static/js/modules/app_interactions.js"></script>
    <script src="/static/js/modules/navigation.js"></script>
    <script src="/static/js/score_modal.js"></script>
    <script src="/static/js/bayes_init.js"></script>
    <script src="/static/js/main.js"></script>
</body>

</html>